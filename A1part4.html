<html>
    <head>
        <title>Part4</title>
        <style>
            p {font-weight: bold; font-size: large;}

            table.HTML_Form {
                border: 1px solid black;
                border-collapse: collapse; /*remove double line border*/
            }

            table.HTML_Form td {padding:10px;}

            table.HTML_Form tr:nth-child(4n) {border-bottom: 1px solid black;} /*adds a border every 4th row*/

            .errorMessage {color: red;}

            .input_text {width:220px;}
        </style>

        <script>
            function validateForm(){

                /* form validation for name text field */
                var name_ = document.getElementById("Name").value.trim();
                var modCode = document.getElementById("ModuleCode").value.trim();

                document.getElementById("nameError1").innerHTML = "";
                document.getElementById("nameError2").innerHTML = "";
                document.getElementById("modCodeError").innerHTML = "";

                if(name_ == null || name_ == "")
                {
                    document.getElementById("nameError2").innerHTML="Invalid name. Field cannot be empty"
                    isValid = false;
                }

                else if(/^[A-Za-z ]+$/.test(name_) == false)
                {
                    document.getElementById("nameError1").innerHTML="Invalid name. Only letters and spaces are allowed";
                    isValid = false;
                }
                
                if( modCode !== "" && /^[A-Z]{2}[4-8]{3}$/.test(modCode) == false)
                {
                    document.getElementById("modCodeError").innerHTML="Invalid module code. Format: 2 letters + 3 digits 4-8"
                    isValid = false;
                } 

                return isValid;
             }

             function getcurrentDate() 
             {
                /*Create a new Date object*/
                var today = new Date();

                var day = today.getDate();
                var year = today.getFullYear();
                var hours = today.getHours();
                var minutes= today.getMinutes();

                var monthList = ["January","February","March","April","May","June","July","August","September","October","November","December"];
                var monthName = monthList[today.getMonth()];

                var weekdayList = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                var weekday = weekdayList[today.getDay()];

                var formatted_minutes = minutes < 10 ? "0" + minutes : minutes;
                var ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12 || 12; /*convert 0 to 12 for midnight*/

                /*Format the date into readable string*/
                var formattedDate = day + " " +
                monthName + " " + year + " " + weekday +" "+ hours +":"+ 
                formatted_minutes +" "+ ampm
                
                document.getElementById("currentDate").defaultValue = formattedDate;
             }

             function findAndReplace() {
                var findInput = document.getElementById("find");
                var replaceInput = document.getElementById("replace");
                var textArea = document.getElementById("comments");
                var replaceResult = document.getElementById("replaceResult");
                var findReplaceBtn = document.getElementById("findReplaceBtn");

                /*When user types in the "find" box, enables "replace" box*/
                findInput.addEventListener("input", function() 
                {
                    replaceInput.disabled = (findInput.value.trim() === "");
                    if (replaceInput.disabled) {
                        replaceInput.value = "";
                        replaceResult.textContent = "";
                    }  
                });
                /*Click event for Find & Replace button*/
                findReplaceBtn.addEventListener("click", function() {
                var findText = findInput.value.trim();
                var replaceText = replaceInput.value;
                var message = textArea.value;

                if (findText === "") {
                    return;
                }

                if (message.includes(findText)) {
                    /*Replace all keywords using replaceAll*/
                    var newMessage = message.replaceAll(findText, replaceText);

                    /* Count replacements */
                    var matchCount = (message.split(findText).length - 1);

                    /* Update textarea and result message */
                    textArea.value = newMessage;
                    replaceResult.textContent = `${matchCount} replacement made.`;
                } 
                else 
                {
                    replaceResult.textContent = "No matches found.";
                }
                });
            };

            function translate() {
                document.getElementById("Translate").addEventListener("click", function() {
                    var sourceLang = document.querySelector('input[name="sourceLanguage"]:checked').value
                    var targetLang = document.getElementById("targetLanguage").value;
                    var message = document.getElementById("comments").value.trim();
                    var encodedMessage = encodeURIComponent(message);
                    var url = `https://translate.google.com/?sl=${sourceLang}&tl=${targetLang}&text=${encodedMessage}&op=translate`;
                    window.open(url, "_blank");
                });
            };
        </script>
    </head>
    <body>
        <form onsubmit="return validateForm()">
                <table class="HTML_Form">
                    <tr>
                        <td colspan="2">
                            <p>Part 4:</p>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <label for="Name">Name:</label><br>
                        </td>
                        <td>
                            <input type="text" name="Name" id="Name" class="input_text">
                            <span id="nameError1" class="errorMessage"></span>
                            <span id="nameError2" class="errorMessage"></span>
                        </td>
                    </tr> 
                    
                    <tr>
                        <td>
                            <label for="moduleCode">Module Code:</label>
                        </td>
                        <td>
                            <input type="text" name="ModuleCode" id="ModuleCode" class="input_text">
                            <span id="modCodeError" class="errorMessage"></span>
                            <br />
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <label for="currentDate">Current Date:</label>
                        </td>
                        <td>
                            <input type="text" id="currentDate" readonly class="input_text">
                            <script>
                                getcurrentDate()
                            </script>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <label for="message">Message:</label>
                        </td>

                        <td>
                            <textarea name="comments" id="comments" rows="3" cols="20">Hello 202509</textarea>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <label for="find">Find:</label>
                        </td>
                        <td>
                            <input type="text" name="find" id="find">
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <label for="replace">Replace:</label>
                        </td>
                        <td>
                            <input type="text" name="replace" id="replace" disabled>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <button id="findReplaceBtn">Find & Replace</button>
                            <span id="replaceResult" class="errorMessage"></span>
                            <script>findAndReplace();</script>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="sourceLanguage">Source Language:</label>
                        </td>
                        <td>
                            <input type="radio" name="sourceLanguage" value="en" checked>English
                            <input type="radio" name="sourceLanguage" value="ms">Malay
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="targetLanguage">Target Language:</label>
                        </td>
                        <td>
                            <select id="targetLanguage">
                                <option value="zh-CN" selected>Chinese</option>
                                <option value="ko">Korean</option>
                                <option value="ja">Japanese</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input type="submit" id="Translate" value="Translate">
                            <input type="reset" value="reset">
                            <script>translate();</script>
                        </td>
                    </tr>
                </table>
        </form>
    </body>
</html>